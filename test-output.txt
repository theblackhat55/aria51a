
> aria5-platform@5.1.0 test:coverage
> vitest run --coverage


 RUN  v1.6.1 /home/user/webapp
      Coverage enabled with v8

 ✓ tests/unit/domain/AggregateRoot.test.ts  (28 tests) 24ms
 ❯ tests/unit/presentation/Middleware.test.ts  (0 test)
stderr | tests/unit/domain/CoreDomain.test.ts > EventBus > should handle errors gracefully
Error handling event TestEvent: Error: Handler error
    at Object.<anonymous> (/home/user/webapp/tests/unit/domain/CoreDomain.test.ts:158:42)
    at Object.mockCall (file:///home/user/webapp/node_modules/@vitest/spy/dist/index.js:50:17)
    at Object.spy [as handle] (file:///home/user/webapp/node_modules/tinyspy/dist/index.js:42:80)
    at EventBus.publish (/home/user/webapp/src/core/domain/events/EventBus.ts:82:36)
    at /home/user/webapp/tests/unit/domain/CoreDomain.test.ts:165:20
    at file:///home/user/webapp/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///home/user/webapp/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///home/user/webapp/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///home/user/webapp/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///home/user/webapp/node_modules/@vitest/runner/dist/index.js:909:15)

 ✓ tests/unit/domain/CoreDomain.test.ts  (29 tests) 39ms
stdout | tests/unit/infrastructure/Infrastructure.test.ts > ConsoleLogger > should log debug messages
{"timestamp":"2025-10-22T19:11:00.734Z","level":"debug","message":"Debug message"}

stdout | tests/unit/infrastructure/Infrastructure.test.ts > ConsoleLogger > should log info messages
{"timestamp":"2025-10-22T19:11:00.747Z","level":"info","message":"Info message"}

stderr | tests/unit/infrastructure/Infrastructure.test.ts > ConsoleLogger > should log warn messages
{"timestamp":"2025-10-22T19:11:00.748Z","level":"warn","message":"Warning message"}

stderr | tests/unit/infrastructure/Infrastructure.test.ts > ConsoleLogger > should log error messages
{"timestamp":"2025-10-22T19:11:00.749Z","level":"error","message":"Error message"}

stdout | tests/unit/infrastructure/Infrastructure.test.ts > ConsoleLogger > should log with context
{"timestamp":"2025-10-22T19:11:00.750Z","level":"info","message":"Message","userId":"123","action":"login"}

stdout | tests/unit/infrastructure/Infrastructure.test.ts > ConsoleLogger > should create child logger with context
{"timestamp":"2025-10-22T19:11:00.751Z","level":"info","message":"Child message","service":"AuthService"}

stdout | tests/unit/infrastructure/Infrastructure.test.ts > ConsoleLogger > should include timestamp in logs
{"timestamp":"2025-10-22T19:11:00.752Z","level":"info","message":"Test message"}

 ❯ tests/unit/infrastructure/Infrastructure.test.ts  (29 tests | 10 failed) 40ms
   ❯ tests/unit/infrastructure/Infrastructure.test.ts > ConsoleLogger > should log debug messages
     → expected "log" to be called at least once
   ❯ tests/unit/infrastructure/Infrastructure.test.ts > ConsoleLogger > should log info messages
     → expected "log" to be called at least once
   ❯ tests/unit/infrastructure/Infrastructure.test.ts > ConsoleLogger > should log warn messages
     → expected "log" to be called at least once
   ❯ tests/unit/infrastructure/Infrastructure.test.ts > ConsoleLogger > should log error messages
     → expected "log" to be called at least once
   ❯ tests/unit/infrastructure/Infrastructure.test.ts > ConsoleLogger > should log with context
     → expected "log" to be called at least once
   ❯ tests/unit/infrastructure/Infrastructure.test.ts > ConsoleLogger > should create child logger with context
     → expected "log" to be called at least once
   ❯ tests/unit/infrastructure/Infrastructure.test.ts > ConsoleLogger > should include timestamp in logs
     → Cannot read properties of undefined (reading '0')
   ❯ tests/unit/infrastructure/Infrastructure.test.ts > PaginationDTO > should create pagination response
     → expected undefined to be true // Object.is equality
   ❯ tests/unit/infrastructure/Infrastructure.test.ts > PaginationDTO > should validate pagination parameters
     → expected [Function] to throw an error
   ❯ tests/unit/infrastructure/Infrastructure.test.ts > PaginationDTO > should determine hasMore correctly
     → expected undefined to be true // Object.is equality
 ✓ tests/unit/domain/BaseEntity.test.ts  (27 tests) 39ms

⎯⎯⎯⎯⎯⎯ Failed Suites 1 ⎯⎯⎯⎯⎯⎯⎯

 FAIL  tests/unit/presentation/Middleware.test.ts [ tests/unit/presentation/Middleware.test.ts ]
Error: Failed to resolve import "../../../domain/exceptions/ValidationException" from "src/core/presentation/middleware/ValidationMiddleware.ts". Does the file exist?
 ❯ TransformPluginContext._formatError node_modules/vitest/node_modules/vite/dist/node/chunks/dep-C6uTJdX2.js:49258:41
 ❯ TransformPluginContext.error node_modules/vitest/node_modules/vite/dist/node/chunks/dep-C6uTJdX2.js:49253:16
 ❯ normalizeUrl node_modules/vitest/node_modules/vite/dist/node/chunks/dep-C6uTJdX2.js:64291:23
 ❯ async file:/home/user/webapp/node_modules/vitest/node_modules/vite/dist/node/chunks/dep-C6uTJdX2.js:64423:39
 ❯ TransformPluginContext.transform node_modules/vitest/node_modules/vite/dist/node/chunks/dep-C6uTJdX2.js:64350:7
 ❯ PluginContainer.transform node_modules/vitest/node_modules/vite/dist/node/chunks/dep-C6uTJdX2.js:49099:18
 ❯ loadAndTransform node_modules/vitest/node_modules/vite/dist/node/chunks/dep-C6uTJdX2.js:51977:27

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/11]⎯

⎯⎯⎯⎯⎯⎯ Failed Tests 10 ⎯⎯⎯⎯⎯⎯⎯

 FAIL  tests/unit/infrastructure/Infrastructure.test.ts > ConsoleLogger > should log debug messages
AssertionError: expected "log" to be called at least once
 ❯ tests/unit/infrastructure/Infrastructure.test.ts:112:24
    110|   it('should log debug messages', () => {
    111|     logger.debug('Debug message');
    112|     expect(consoleSpy).toHaveBeenCalled();
       |                        ^
    113|   });
    114| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/11]⎯

 FAIL  tests/unit/infrastructure/Infrastructure.test.ts > ConsoleLogger > should log info messages
AssertionError: expected "log" to be called at least once
 ❯ tests/unit/infrastructure/Infrastructure.test.ts:117:24
    115|   it('should log info messages', () => {
    116|     logger.info('Info message');
    117|     expect(consoleSpy).toHaveBeenCalled();
       |                        ^
    118|   });
    119| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/11]⎯

 FAIL  tests/unit/infrastructure/Infrastructure.test.ts > ConsoleLogger > should log warn messages
AssertionError: expected "log" to be called at least once
 ❯ tests/unit/infrastructure/Infrastructure.test.ts:122:24
    120|   it('should log warn messages', () => {
    121|     logger.warn('Warning message');
    122|     expect(consoleSpy).toHaveBeenCalled();
       |                        ^
    123|   });
    124| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/11]⎯

 FAIL  tests/unit/infrastructure/Infrastructure.test.ts > ConsoleLogger > should log error messages
AssertionError: expected "log" to be called at least once
 ❯ tests/unit/infrastructure/Infrastructure.test.ts:127:24
    125|   it('should log error messages', () => {
    126|     logger.error('Error message');
    127|     expect(consoleSpy).toHaveBeenCalled();
       |                        ^
    128|   });
    129| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/11]⎯

 FAIL  tests/unit/infrastructure/Infrastructure.test.ts > ConsoleLogger > should log with context
AssertionError: expected "log" to be called at least once
 ❯ tests/unit/infrastructure/Infrastructure.test.ts:132:24
    130|   it('should log with context', () => {
    131|     logger.info('Message', { userId: '123', action: 'login' });
    132|     expect(consoleSpy).toHaveBeenCalled();
       |                        ^
    133|   });
    134| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[6/11]⎯

 FAIL  tests/unit/infrastructure/Infrastructure.test.ts > ConsoleLogger > should create child logger with context
AssertionError: expected "log" to be called at least once
 ❯ tests/unit/infrastructure/Infrastructure.test.ts:138:24
    136|     const childLogger = logger.child({ service: 'AuthService' });
    137|     childLogger.info('Child message');
    138|     expect(consoleSpy).toHaveBeenCalled();
       |                        ^
    139|   });
    140| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[7/11]⎯

 FAIL  tests/unit/infrastructure/Infrastructure.test.ts > ConsoleLogger > should include timestamp in logs
TypeError: Cannot read properties of undefined (reading '0')
 ❯ tests/unit/infrastructure/Infrastructure.test.ts:143:57
    141|   it('should include timestamp in logs', () => {
    142|     logger.info('Test message');
    143|     const logOutput = JSON.parse(consoleSpy.mock.calls[0][0]);
       |                                                         ^
    144|     expect(logOutput).toHaveProperty('timestamp');
    145|   });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[8/11]⎯

 FAIL  tests/unit/infrastructure/Infrastructure.test.ts > PaginationDTO > should create pagination response
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 ❯ tests/unit/infrastructure/Infrastructure.test.ts:160:30
    158|     expect(response.total).toBe(10);
    159|     expect(response.totalPages).toBe(2);
    160|     expect(response.hasMore).toBe(true);
       |                              ^
    161|   });
    162| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[9/11]⎯

 FAIL  tests/unit/infrastructure/Infrastructure.test.ts > PaginationDTO > should validate pagination parameters
AssertionError: expected [Function] to throw an error
 ❯ tests/unit/infrastructure/Infrastructure.test.ts:171:49
    169|   it('should validate pagination parameters', () => {
    170|     expect(() => PaginationDTO.validate(1, 10)).not.toThrow();
    171|     expect(() => PaginationDTO.validate(0, 10)).toThrow();
       |                                                 ^
    172|     expect(() => PaginationDTO.validate(1, 0)).toThrow();
    173|     expect(() => PaginationDTO.validate(-1, 10)).toThrow();

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[10/11]⎯

 FAIL  tests/unit/infrastructure/Infrastructure.test.ts > PaginationDTO > should determine hasMore correctly
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 ❯ tests/unit/infrastructure/Infrastructure.test.ts:189:31
    187|   it('should determine hasMore correctly', () => {
    188|     const response1 = PaginationDTO.createResponse([], 10, 1, 5);
    189|     expect(response1.hasMore).toBe(true);
       |                               ^
    190|     
    191|     const response2 = PaginationDTO.createResponse([], 10, 2, 5);

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[11/11]⎯

 Test Files  2 failed | 3 passed (5)
      Tests  10 failed | 103 passed (113)
   Start at  19:10:56
   Duration  4.56s (transform 372ms, setup 0ms, collect 440ms, tests 142ms, environment 1.73s, prepare 780ms)

